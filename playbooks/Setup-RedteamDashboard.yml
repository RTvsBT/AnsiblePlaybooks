---
- hosts: RedteamDashboard
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:

    - name: Install dependencies
      become: yes
      apt:
        pkg:
        - npm
        - python3-pip
        - apache2
        - libapache2-mod-wsgi-py3
        - python3-dev
        
    - name: Install dependencies
      become: yes
      pip:
        name:
        - flask
        - flask_cors
        - pwntools

    - name: Change Hostname filie
      become: yes
      shell: hostnamectl set-hostname RedteamDashboard
    
    - name: Change hosts file
      become: yes
      shell: sed -i '2 c 127.0.0.1    RedteamDashboard' /etc/hosts
      args:
        warn: false

    - name: Create flask folder
      become: yes
      file:
        path: /var/www/flask
        state: directory  
    - name: Move the webserver files
      become: yes
      copy:
        owner: www-data
        src: ~/RTvsBT/RedteamDashboardBackend/
        dest: /var/www/flask/
    - name: Move the webserver files
      become: yes
      copy:
        # owner: www-data
        src: ~/RTvsBT/AnsiblePlaybooks/assets/RedteamBackend/RedteamBackend.conf
        dest: /etc/apache2/sites-available/RedteamBackend.conf
    - name: Enable site
      become: yes
      shell: a2ensite RedteamBackend 
        
    
    # - name: Remove default apache page.
      # become: yes
      # file:
        # path: /var/www/html/index.html
        # state: absent
    # - name: seed the database
      # become: yes
      # shell: mysql < /var/www/html/db.sql
   # - name: Change to static ip
    # 
    # - name: Patch apparmor
      # become: yes
      # lineinfile:
        # path: /etc/apparmor.d/usr.sbin.mysqld
        # insertbefore: '^}'
        # line: '   /var/www/html/** rw,'
    # - name: Patch mysqld.cnf
      # become: yes
      # lineinfile:
        # path: /etc/mysql/mysql.conf.d/mysqld.cnf
        # insertbefore: '^secure_file_priv='
        # line: 'secure_file_priv=""'
    # - name: change folder permissions
      # become: yes
      # file:
        # path: /var/www/html
        # mode: '777'
    # - name: add www-data to the mysql group
      # become: yes
      # shell: usermod -a -G mysql www-data
    
    - name: Restart server
      become: yes
      reboot:

